function g(t){t.directive("intersect",t.skipDuringClone((e,{value:s,expression:n,modifiers:r},{evaluateLater:o,cleanup:u})=>{let m=o(n),f={rootMargin:b(r),threshold:p(r)},i=new IntersectionObserver(h=>{h.forEach(d=>{d.isIntersecting!==(s==="leave")&&(m(),r.includes("once")&&i.disconnect())})},f);i.observe(e),u(()=>{i.disconnect()})}))}function p(t){if(t.includes("full"))return .99;if(t.includes("half"))return .5;if(!t.includes("threshold"))return 0;let e=t[t.indexOf("threshold")+1];return e==="100"?1:e==="0"?0:+`.${e}`}function y(t){let e=t.match(/^(-?[0-9]+)(px|%)?$/);return e?e[1]+(e[2]||"px"):void 0}function b(t){const e="margin",s="0px 0px 0px 0px",n=t.indexOf(e);if(n===-1)return s;let r=[];for(let o=1;o<5;o++)r.push(y(t[n+o]||""));return r=r.filter(o=>o!==void 0),r.length?r.join(" ").trim():s}var a=g;function c(){return typeof Alpine>"u"?!1:(Alpine.data("contactForm",()=>({formData:{},errors:{},formError:"",submitted:!1,submitting:!1,config:null,submitUrl:"",successMessage:"",signature:"",pageUrl:"",init(){const t=this.$el.dataset.contactFormConfig;if(!t){console.error("Contact form missing data-contact-form-config attribute");return}try{this.config=JSON.parse(t)}catch(e){console.error("Failed to parse contact form config:",e);return}this.submitUrl=this.config.submitUrl||"",this.successMessage=this.config.successMessage||"Thank you for your message!",this.signature=this.config.signature||"",this.pageUrl=this.config.pageUrl||"",this.formData=(this.config.fieldNames||[]).reduce((e,s)=>({...e,[s]:""}),{_honeypot:""})},async submit(){this.submitting=!0,this.errors={},this.formError="";const t=document.querySelector("meta[name=csrf-token]");if(!t){this.formError="Security token missing. Please refresh the page.",this.submitting=!1;return}try{const e=await fetch(this.submitUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t.content,Accept:"application/json"},body:JSON.stringify({...this.formData,_config:this.config.config,_signature:this.signature,_pageUrl:this.pageUrl})}),s=e.headers.get("content-type");if(!s||!s.includes("application/json")){console.error("Non-JSON response received:",e.status),this.formError="Server returned an unexpected response. Please try again.";return}let n;try{n=await e.json()}catch(r){console.error("Failed to parse JSON response:",r),this.formError="Server returned an invalid response. Please try again.";return}e.ok?this.submitted=!0:e.status===422?this.errors=n.errors||{}:e.status===429?this.formError=n.message||"Too many submissions. Please try again later.":e.status===400?this.formError=n.message||"Invalid request. Please refresh the page and try again.":this.formError=n.message||"An error occurred. Please try again."}catch(e){console.error("Contact form submission error:",e),this.formError="A network error occurred. Please check your connection and try again."}finally{this.submitting=!1}},getFieldError(t){return this.errors[t]?this.errors[t][0]:""},hasFieldError(t){return!!this.errors[t]}})),!0)}c()||document.addEventListener("alpine:init",c);function l(){return typeof Alpine>"u"?!1:(Alpine.data("commentForm",()=>({formData:{author_name:"",author_email:"",content:"",_honeypot:""},errors:{},formError:"",submitted:!1,successMessage:"",submitting:!1,submitUrl:"",postId:null,parentId:null,init(){const t=this.$el.dataset.commentConfig;if(!t){console.error("Comment form missing data-comment-config attribute");return}try{const e=JSON.parse(t);this.submitUrl=e.submitUrl||"",this.postId=e.postId||null,this.parentId=e.parentId||null}catch(e){console.error("Failed to parse comment form config:",e)}},async submit(){this.submitting=!0,this.errors={},this.formError="";const t=document.querySelector("meta[name=csrf-token]");if(!t){this.formError="Security token missing. Please refresh the page.",this.submitting=!1;return}try{const e={post_id:this.postId,content:this.formData.content,_honeypot:this.formData._honeypot};this.parentId&&(e.parent_id=this.parentId),this.formData.author_name&&(e.author_name=this.formData.author_name),this.formData.author_email&&(e.author_email=this.formData.author_email);const s=await fetch(this.submitUrl,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t.content,Accept:"application/json"},body:JSON.stringify(e)}),n=s.headers.get("content-type");if(!n||!n.includes("application/json")){this.formError="Server returned an unexpected response. Please try again.";return}let r;try{r=await s.json()}catch{this.formError="Server returned an invalid response. Please try again.";return}s.ok?(this.successMessage=r.message||"Your comment has been submitted.",this.submitted=!0):s.status===422?this.errors=r.errors||{}:s.status===429?this.formError=r.message||"Too many comments. Please try again later.":s.status===403?this.formError=r.message||"You must be logged in to comment.":this.formError=r.message||"An error occurred. Please try again."}catch(e){console.error("Comment submission error:",e),this.formError="A network error occurred. Please check your connection and try again."}finally{this.submitting=!1}}})),!0)}l()||document.addEventListener("alpine:init",l);window.Alpine?window.Alpine.plugin(a):(window.__tallcmsPlugins=window.__tallcmsPlugins||[],window.__tallcmsPlugins.push(a),document.addEventListener("alpine:init",()=>{(window.__tallcmsPlugins||[]).forEach(t=>{window.Alpine.plugin(t)}),window.__tallcmsPlugins=[]}));
